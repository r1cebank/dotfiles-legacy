#!/usr/bin/env bash
IMAGE=$(mktemp --tmpdir --suffix=.png lock.XXXXXXXXXX)
TEXT=/tmp/locktext.png
ICON="$HOME/.dotfiles/pictures/lock-icon.png"
trap 'rm -f "$IMAGE"' SIGINT SIGTERM EXIT

declare -a lines
maim -u -m 1 \
    | convert png:- -scale 10% -scale 1000% \
    -fill "#282828" -colorize 10% \
    ${lines[*]} "$IMAGE"

[ -f $TEXT ] || {
    convert -size 400x60 xc:black -font Hack-Regular -pointsize 20 -fill white -gravity center -annotate +0+0 'type password to unlock' $TEXT;
    convert $TEXT -alpha set -channel A -evaluate set 50% $TEXT;
}
convert $IMAGE $TEXT -gravity center -geometry +0+250 -composite $IMAGE
convert $IMAGE $ICON -gravity center -composite -matte $IMAGE

i3lock \
    --color=FFFFFFFF \
    --image "$IMAGE" \
    --ind-pos='w/2+110:y+700' \
    --time-pos='w/2:y+700' \
    --time-str='%H:%M:%S' \
    --inside-color=40E0D0FF \
    --insidever-color=E0FFFFFF \
    --insidewrong-color=FF4500FF \
    --ring-color=FFFFFFFF \
    --ringver-color=FFFFFFFF \
    --ringwrong-color=FFFFFFFF \
    --line-color=FFFFFFFF \
    --keyhl-color=00FA9AFF \
    --bshl-color=FF4500FF \
    --separator-color=FFFFFFFF \
    --verif-color=FFFFFFFF \
    --wrong-color=FFFFFFFF \
    --layout-color=FFFFFFFF \
    --time-color=FFFFFFFF \
    --date-color=FFFFFFFF \
    --indicator \
    --greeter-text='' \
    --verif-text='' \
    --wrong-text='' \
    --noinput-text='' \
    --lock-text='' \
    --lockfailed-text='' \
    --time-font='Hack' \
    --ignore-empty-password \
    --pass-media-keys \
    --radius=16 \
    --ring-width=5 \
    --force-clock

# i3lock \
#     --color=282828 \
#     --image="$image" \
#     --inside-color=282828FF \
#     --insidever-color=FABD2FFF \
#     --insidewrong-color=FB4934FF \
#     --ring-color=282828FF \
#     --ringver-color=282828FF \
#     --ringwrong-color=282828FF \
#     --line-color=EBDBB2FF \
#     --keyhl-color=EBDBB2FF \
#     --bshl-color=FB4934FF \
#     --separator-color=282828FF \
#     --verif-color=00000000 \
#     --wrong-color=00000000 \
#     --layout-color=00000000 \
#     --time-color=EBDBB2FF \
#     --date-color=00000000 \
#     --ind-pos='x+100:y+720' \
#     --time-pos='x+280:y+732' \
#     --time-str='%H:%M:%S' \
#     --time-font='Hack' \
#     --time-size=32 \
#     --radius=32 \
#     --ring-width=4 \
#     --greeter-text='' \
#     --verif-text='' \
#     --wrong-text='' \
#     --noinput-text='' \
#     --lock-text='' \
#     --lockfailed-text='' \
#     --indicator \
#     --ignore-empty-password \
#     --pass-media-keys \
#     --force-clock
